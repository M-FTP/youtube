# การใช้ gdb ฉบับย่อ

โปรแกรมมีบักเป็นของธรรมดามาก ยิ่งภาษา C แล้ว 
เขียนผิดง่ายมากเลยหละ ไม่ใช่เพราะว่าพิมพ์ผิดแล้วคอมไพล์ไม่ผ่าน  
แต่มักจะมีปัญหาเรื่องอัลกอริทึมและการใช้ผิดๆ pointer และหลงๆ 
ลืมๆต่างๆนานา ในตัวอย่างนี้จะให้ gdb เป็นดีบักเกอร์ เพื่อทำการดู 
step การทำงานขอโปรแกรมของเราให้ลองเชียนโปรแกรมเล็กๆขึ้นมา
สักอันหนึ่ง ผมจะใช้โปรแกรมนี้เป็นตัวอย่างแล้วกัน
``` c
main()
{
  int i;
  char *text="hello";
  for(i=0;i<5;i++)
  {
    printf("hello %d\n",i);
  }
  return 0;
}   
```
เซฟเป็นไฟล์ชื่อ test.c เวลาคอมไพล์ก็ให้ใส่ออปชัน -g 
เพื่อที่จะได้ดีบักได้ ดังนี้
``` sh
$ gcc test.c -g
```
ไฟล์ที่ได้จะใหญ่กว่าปรกติดเพราะว่ามีข้อมูลสำหรับทำการ
ดีบักอยู่ เวลาเริ่มดีบักก็
``` sh
$ gdb ./a.out
```
หลังจากนั้นจะเห็นข้อความยาวๆ เกี่ยวกับ GNU 
ช่างมันเถอะปล่อยผ่านไป แล้วจะเห็น prompt ดังนี้
```
(gdb)
```
อย่างแรกที่เราต้องทำก็คือเซ็ต break point 
เพื่อให้โปรแกรมหยุดตรงที่ต้องการ เอาให้หยุดตรงฟังก์ชัน 
main() ก็แล้วกัน ก็ให้พิมพ์ดังนี้ "b main" ก็จะเป็นดังข้างล่าง
```
(gdb) b main
Breakpoint 1 at 0x8048476: file test.c, line 4. 
```
หลังจากนั้นก็เริ่มรันโปรแกรมได้เลยด้วยการพิมพ์ "r" 
มันก็จะออกมาคล้ายๆกับข้างล่างนี้
```
(gdb) r
Starting program: /tmp/oom/./a.out

Breakpoint 1, main () at test.c:4
4         char *text="hello";
(gdb)
```
คำสั่งพื้นฐานและใช้บ่อยที่ควรทราบก็คือ (สามารถทดลองพิมพ์ตรงนี้ได้เลย)
n 
	รันโปรแกรมบรรทัดถัดไป(next) 
b [เลขบรรทัด/ชื่อฟังก์ชัน]
	สร้าง break-point ถ้าพิมพ์แค่ "b" ก็จะสร้าง break-point ตรงบรรทัดนั้นเลย
s
	เข้าไปในฟังก์ชัน บางที่เรียกว่า step-into
p <ชื่อตัวแปร>
	ใช้พิมพ์ชื่อตัวแปรออกมา

มาเริ่มทดลองต่อเลยก็แล้วกันโดยการพิมพ์ "n"
```
(gdb) n
5         for(i=0;i<5;i++) 
```
ถ้าจะรันคำสั่ง "n" ซ้ำๆ ก็กด Enter ได้เลยไม่ต้องพิมพ์ซ้ำ
หลังจากรันคำสั่ง "n" ไปสักสิบหนถ้าจำไม่ได้ว่าอยู่ตรงไหนแล้วให้พิมพ์ "l" เพื่อโชว์บรรทัดรอบข้าง
```
(gdb) l
3         int i;
4         char *text="hello";
5         for(i=0;i<5;i++)
6         {
7           printf("hello %d\n",i);
8         }
9         return 0;
10      }
(gdb)  
```
ตอนนี้ลองมาพิมพ์ตัวแปร "i" ออกมาดูดังนี้
```
(gdb) p i
$1 = 4
(gdb) p text
$2 = 0x80484fc "hello" 
```
จะเห็นได้ว่าตอนนี้ค่า i เป็น 4 และตัวแปร text ชี้ไปที่คำว่า "hello"

ถ้ากด "n" กับ Enter จนเมื่อยแล้วจะให้โปรแกรมรันต่อก็ให้กด 
"c" (continue) ถ้ามันไม่ติด break-point หรือรอรับ input 
โปรแกรมก็จะรันจนจบ
```
(gdb) c
Continuing.

Program exited normally.
(gdb)                  
```
ให้พิมพ์ quit เพื่อจบโปรแกรม หรือ r เพื่อดีบักอีกรอบ

to be continue ...
